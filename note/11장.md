# 코루틴과 동시성 프로그래밍

## 동시성 프로그래밍

- 동기적(Synchronous) 수행
    - 순서대로 작업을 수행하여 하나의 루틴을 완료한 후 다른 루틴을 실행하는 방식
    - 다양한 기능이 한꺼번에 일어나는 다중 실행 환경에서는 성능상의 제약 발생
        - UI, 데이터 다운로드를 동시에 대응해야 하는 경우
- 비동기적(Asynchronous) 수행
    - 다양한 기능을 동시에 수행할 수 있는 방식
    - 전통적인 스레드를 이용하거나 RxJava, Reactive 와 같은 서드파티 라이브러리에서 제공
    - Kotlin 에서는 Coroutines 를 기본으로 제공

- Coroutines
    - 먼저 하나의 개별적인 작업을 루틴(routine)이라고 부르는데 여러 개의 루틴들이 협력(co)한다는 의미로 만들어진 합성어
    - Kotlin 의 Coroutines 를 사용하면 Non-blocking 또는 비동기 코드를 마치 일반적인 동기 코드처럼 쉽게 작성하면서도 비동기 효과를 낼 수 있음

### 동시성 프로그래밍 용어 정리

- Blocking 동작

![Blocking Sequence Diagram](img/blocking_sequence_diagram.png)

- Non-blocking 동작

![Non-Blocking Sequence Diagram](img/non_blocking_sequence_diagram.png)

### 프로세스와 스레드

- Task 개념
    - 보통 Task 는 큰 실행 단위인 프로세스나 좀 더 작은 실행 단위인 스레드로 생각할 수 있음
    - 프로세스는 실행되는 메모리, 스택, 열린 파일 등을 모두 포함하기 때문에 프로세스간 문맥 교환(context-switching)을 하는데 비용이 큼
    - 스레드는 자신의 스택만 독립적으로 가지고 나머지는 대부분 공유하므로 문맥 교환 비용이 낮아 프로그래밍에서 많이 사용
    - 다만 여러 개의 스레드를 구성하면 코드가 복잡

### 문맥교환(Context-Switching)

- 하나의 프로세스나 스레드가 CPU 를 사용하고 있는 상태에서 다른 프로세스나 스레드가 CPU 를 사용하도록 하기 위해, 이전의 프로세스의 상태(문맥)를 보관화고 새로운 프로세스의 상태를 적재하는 과정

![Context Switching](img/context_switching.png)